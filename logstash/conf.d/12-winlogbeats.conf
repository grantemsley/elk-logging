filter {
    if [type] == "wineventlog" {
        # Remove ::ffff from IP addresses
        mutate {
            gsub => ["[event_data][IpAddress]", "::ffff:", ""]
        }

        # Drop logs we don't care about
        if [log_name] == "System" and [event_id] == 7036 and [event_data][param1] == "Windows Modules Installer" { drop {} } # Windows modules installer service starting/stopping
        if [log_name] == "System" and [event_id] == 7040 and [event_data][param1] == "Background Intelligent Transfer Service" { drop {} } # Service being set to on demand/auto, very spammy
        if [log_name] == "System" and [event_id] == 1500 { drop {} } # Group policy processing
        if [log_name] == "System" and [event_id] == 1501 { drop {} } # Group policy processing
        


        # Handle security logs - clean up some event logs - remove the long full message and replace with short messages
        if [log_name] == "Security" {
            if [event_id] == 4624 or [event_id] == 4634 {
                mutate {
                    remove_field => ["message"]
                    add_field => { "short_message" => "Logon Activity" }
                }
            }
            if [event_id] == 4625 {
                mutate {
                    remove_field => ['message']
                    add_field => { "short_message" => "Logon Failure" }
                }
            }
            if [event_id] == 4648 {
                mutate {
                    remove_field => ['message']
                    add_field => { "short_message" => "A logon was attempted using explicit credentials" }
                }
            }
            if [event_id] == 4727 { mutate { add_field => { "short_message" => "A security-enabled global group was created"} } }
            if [event_id] == 4728 { mutate { add_field => { "short_message" => "A member was added to a security-enabled global group"} } }
            if [event_id] == 4729 { mutate { add_field => { "short_message" => "A member was removed from a security-enabled global group"} } }
            if [event_id] == 4730 { mutate { add_field => { "short_message" => "A security-enabled global group was deleted"} } }
            if [event_id] == 4731 { mutate { add_field => { "short_message" => "A security-enabled local group was created"} } }
            if [event_id] == 4732 { mutate { add_field => { "short_message" => "A member was added to a security-enabled local group"} } }
            if [event_id] == 4733 { mutate { add_field => { "short_message" => "A member was removed from a security-enabled local group"} } }
            if [event_id] == 4734 { mutate { add_field => { "short_message" => "A security-enabled local group was deleted"} } }
            if [event_id] == 4735 { mutate { add_field => { "short_message" => "A security-enabled local group was changed"} } }
            if [event_id] == 4737 { mutate { add_field => { "short_message" => "A security-enabled global group was changed"} } }
            if [event_id] == 4754 { mutate { add_field => { "short_message" => "A security-enabled universal group was created"} } }
            if [event_id] == 4755 { mutate { add_field => { "short_message" => "A security-enabled universal group was changed"} } }
            if [event_id] == 4756 { mutate { add_field => { "short_message" => "A member was added to a security-enabled universal group"} } }
            if [event_id] == 4757 { mutate { add_field => { "short_message" => "A member was removed from a security-enabled universal group"} } }
            if [event_id] == 4758 { mutate { add_field => { "short_message" => "A security-enabled universal group was deleted"} } }
            if [event_id] == 4764 { mutate { add_field => { "short_message" => "A group's type was changed"} } }

            # Add logon type fields for event IDs 4624,4634,4525
            if [event_data][LogonType] == "2" { mutate { add_field => { "Method" => "Interactive - Keyboard" } } }
            if [event_data][LogonType] == "3" { mutate { add_field => { "Method" => "Network Logon" } } }
            if [event_data][LogonType] == "4" { mutate { add_field => { "Method" => "Batch - Scheduled Task" } } }
            if [event_data][LogonType] == "5" { mutate { add_field => { "Method" => "Service Account" } } }
            if [event_data][LogonType] == "7" { mutate { add_field => { "Method" => "Unlock System" } } }
            if [event_data][LogonType] == "8" { mutate { add_field => { "Method" => "NetworkCleartext" } } }
            if [event_data][LogonType] == "9" { mutate { add_field => { "Method" => "NewCredentials" } } }
            if [event_data][LogonType] == "10" { mutate { add_field => { "Method" => "RemoteInteractive" } } }
            if [event_data][LogonType] == "11" { mutate { add_field => { "Method" => "CachedInteractive" } } }
            if [event_data][LogonType] == "0" { mutate { add_field => { "Method" => "System Account" } } }

            # Add status for event IDs 4771, 4776, 4769, 4768
            if [event_data][Status] == "0x0" { mutate { add_field => { "Statusmsg" => "Success" } } }
            if [event_data][Status] == "0x12" { mutate { add_field => { "Statusmsg" => "Account: disabled,expired,locked out,logon hours" } } }
            if [event_data][Status] == "0xB" { mutate { add_field => { "Statusmsg" => "Request start time is later than end time" } } }
            if [event_data][Status] == "0x17" { mutate { add_field => { "Statusmsg" => "Password has expired" } } }
            if [event_data][Status] == "0x18" { mutate { add_field => { "Statusmsg" => "Bad password" } } }
            if [event_data][Status] == "0x1b" { mutate { add_field => { "Statusmsg" => "Server principal valid for user-to-user only" } } }
            if [event_data][Status] == "0x1d" { mutate { add_field => { "Statusmsg" => "A service is not available" } } }
            if [event_data][Status] == "0x20" { mutate { add_field => { "Statusmsg" => "Ticket expired - frequently logged by computer accounts" } } }
            if [event_data][Status] == "0x25" { mutate { add_field => { "Statusmsg" => "Workstation's clock out of sync with DC" } } }
            if [event_data][Status] == "0x6" { mutate { add_field => { "Statusmsg" => "Username does not exist or has not replicated" } } }
            if [event_data][Status] == "0xc000006a" { mutate { add_field => { "Statusmsg" => "Incorrect password" } } }
            if [event_data][Status] == "0xc0000064" { mutate { add_field => { "Statusmsg" => "Username does not exist" } } }
            if [event_data][Status] == "0xc0000072" { mutate { add_field => { "Statusmsg" => "Account is disabled" } } }
            if [event_data][Status] == "0xc0000234" { mutate { add_field => { "Statusmsg" => "Account is locked out" } } }
            if [event_data][Status] == "0xc0000193" { mutate { add_field => { "Statusmsg" => "Account expired" } } }
            if [event_data][Status] == "0xc000006f" { mutate { add_field => { "Statusmsg" => "Logon outside hours" } } }
            if [event_data][Status] == "0xc0000224" { mutate { add_field => { "Statusmsg" => "User required to change password next time" } } }
            if [event_data][Status] == "0xc0000071" { mutate { add_field => { "Statusmsg" => "Password expired" } } }
            if [event_data][Status] == "0xc000006d" { mutate { add_field => { "Statusmsg" => "Logon Failure" } } }
            if [event_data][Status] == "0xc000006e" { mutate { add_field => { "Statusmsg" => "Unknown username or bad password" } } }
            if [event_data][Status] == "0xc000005e" { mutate { add_field => { "Statusmsg" => "No logon servers available to login" } } }
            if [event_data][Status] == "0xc0000133" { mutate { add_field => { "Statusmsg" => "Workstation's clock out of sync with the DC" } } }
            if [event_data][Status] == "0xc00002ee" { mutate { add_field => { "Statusmsg" => "An error occured during logon" } } }
            if [event_data][Status] == "0xc000015b" { mutate { add_field => { "Statusmsg" => "Login not allowed for this system" } } }
            if [event_data][Status] == "0xc0000225" { mutate { add_field => { "Statusmsg" => "Windows bug and not a risk" } } }
        }
        # End of security section
    }
}            
